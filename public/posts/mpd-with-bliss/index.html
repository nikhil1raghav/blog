<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>How to set up mpd with blissify | Nikhil Raghav</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
<link rel="stylesheet" href="/assets/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous">
<script defer src="/assets/katex.min.js" integrity="sha384-YNHdsYkH6gMx9y3mRkmcJ2mFUjTd0qNQQvY9VYZgQd7DcN7env35GzlmFaZ23JGp" crossorigin="anonymous"></script>
<script defer src="/assets/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>

  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/about">About</a></li>
      
      <li><a href="/books">Books</a></li>
      
      <li><a href="/links">Links</a></li>
      
      <li><a href="/posts">Posts</a></li>
      
      <li><a href="/subscribe">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">How to set up mpd with blissify</span></h1>

<h2 class="date">2021/07/02</h2>
</div>

<main>
<p><a href="https://github.com/MusicPlayerDaemon/MPD">MPD</a> is a server-side music player, which can be further improved by using different plugins and libraries to enhance overall music listening experience on all the devices on a network.</p>
<p>As it is a server-side application you&rsquo;ll also need a client to go along with it, usually MPD can relay its output to different channels at the same time so you can enjoy it on anything that can process a http stream and is on the same network (any device with a web browser).</p>
<p>To create playlists and to get more fine-grained control, consider installing <code>ncmpcpp</code> or <code>ncmpc</code> former is written in C++ and latter in C.</p>
<p><a href="https://github.com/Polochon-street/bliss">Bliss</a> is a C library that computes distance between songs, so once you run it through your complete music collection, it will help you generate playlists on the song or album you are currently playing by queuing similar tracks.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo pacman -S ncmpcpp mpd mpc
</span></span></code></pre></div><h2 id="why-should-you-use-mpd">Why should you use MPD?</h2>
<p>Is your music collection over 100GB which doesn&rsquo;t fit on a sd card so you have to choose what songs to store in your mobile? Some music players can&rsquo;t process that kind of collection at once.</p>
<p>Do you want to run your own local radio station using songs from your collection, accessible from all your devices?</p>
<p>It looks good on polybar, and is very rice friendly. You can even use your phone as a remote control.</p>
<h2 id="minimal-configuration-of-mpd">Minimal configuration of mpd</h2>
<p>Create a config file for mpd and ncmpcpp in your <code>CONFIG_HOME</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir .config/ncmpcpp
</span></span><span style="display:flex;"><span>mkdir .config/mpd
</span></span><span style="display:flex;"><span>touch .config/mpd/mpd.conf
</span></span><span style="display:flex;"><span>touch .config/ncmpcpp/config
</span></span></code></pre></div><p>Now edit <code>mpd.conf</code>  as shown below and make changes accordingly</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>music_directory	&#34;PATH_TO_YOUR_MUSIC_FOLDER&#34; 
</span></span><span style="display:flex;"><span>db_file 	&#34;~/.config/mpd/database&#34;
</span></span><span style="display:flex;"><span>log_file	&#34;~/.config/mpd/log&#34;
</span></span><span style="display:flex;"><span>pid_file	&#34;~/.config/mpd/pid&#34;
</span></span><span style="display:flex;"><span>state_file	&#34;~/.config/mpd/state&#34;
</span></span><span style="display:flex;"><span>sticker_file	&#34;~/.config/mpd/sticker.sql&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#music daemon options
</span></span><span style="display:flex;"><span>bind_to_address	&#34;any&#34;
</span></span><span style="display:flex;"><span>port	&#34;6700&#34;
</span></span><span style="display:flex;"><span>log_level	&#34;notice&#34;
</span></span><span style="display:flex;"><span>save_absolute_paths_in_playlists	&#34;no&#34;   #writing no so that playlists are portable (path-independent)
</span></span><span style="display:flex;"><span>auto_update	&#34;yes&#34;
</span></span><span style="display:flex;"><span>auto_update_depth &#34;3&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>audio_output {
</span></span><span style="display:flex;"><span>	type	&#34;pulse&#34;
</span></span><span style="display:flex;"><span>	name	&#34;PULSE OUTPUT&#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>audio_output {
</span></span><span style="display:flex;"><span>	type	&#34;httpd&#34;
</span></span><span style="display:flex;"><span>	name	&#34;My HTTP Stream&#34;
</span></span><span style="display:flex;"><span>	port	&#34;8080&#34;
</span></span><span style="display:flex;"><span>	bind_to_address	&#34;0.0.0.0&#34;
</span></span><span style="display:flex;"><span>	bitrate	&#34;128&#34;
</span></span><span style="display:flex;"><span>	format	&#34;44100:16:1&#34;
</span></span><span style="display:flex;"><span>	max_clients &#34;0&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>These are bare-minimum options.</p>
<p><code>/etc/mpd.conf</code> points to example configuration file stored as <code>/usr/share/doc/mpd/mpdconf.example</code> you can look at that for all available options. I will be setting up only the required settings to get you up and running.</p>
<p>To configure <code>ncmpcpp</code> change the contents of <code>config</code> in <code>.config/ncmpcpp</code> to following</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ncmpcpp_directory<span style="color:#f92672">=</span>~/.config/ncmpcpp
</span></span><span style="display:flex;"><span>mpd_port<span style="color:#f92672">=</span><span style="color:#ae81ff">6700</span>
</span></span><span style="display:flex;"><span>mpd_music_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PATH_TO_MUSIC_DIRECTORY&#34;</span>
</span></span></code></pre></div><p>Now to test if everything works fine run <code>mpd</code> then run <code>ncmpcpp</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mpd
</span></span><span style="display:flex;"><span>mpc update
</span></span><span style="display:flex;"><span>ncmpcpp 
</span></span></code></pre></div><hr>
<h2 id="set-up-blissify">Set up blissify</h2>
<p>There are some dependencies needed to build <code>blissify</code>, if you have <code>ffmpeg</code> already installed no need to worry about them.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo pacman -S ffmpeg
</span></span></code></pre></div><p>Clone and build blissify</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git clone --recursive https://github.com/phyks/blissify
</span></span><span style="display:flex;"><span>cd blissify; mkdir build; cd build
</span></span><span style="display:flex;"><span>cmake ..
</span></span><span style="display:flex;"><span>make
</span></span></code></pre></div><p>Move <code>blissify</code> binary thus made in build folder to <code>/usr/bin</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cp build/blissify /usr/bin/
</span></span></code></pre></div><p>Now build the distance database by running <code>server.py</code> script in <code>blissify/mpd</code> folder. MPD should be running right now for this script to work, as it has to make a connection to the port MPD is running on. If you used a different port other than <code>6600</code> then change the ports in the scripts as well.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>python server.py --full-rescan <span style="color:#e6db74">&#34;PATH_TO_MUSIC_DIRECTORY&#34;</span>
</span></span></code></pre></div><p>It will take some time and doesn&rsquo;t support m4a, wav and aif codecs</p>
<p>After <code>server.py</code> script stops adding songs to the database, you can create playlists by running <code>client.py</code> as</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>python client.py --queue-length <span style="color:#e6db74">&#34;NUMBER OF SONGS YOU WANT&#34;</span> --song-based
</span></span></code></pre></div><p><code>--song-based</code> option creates playlist on the basis of the song currently playing or last played song and <code>--album-based</code> option uses the last album as the basis.</p>

</main>

  <footer>
  
  
  </footer>
  </body>
</html>

